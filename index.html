<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disnea y EKG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para el scrollbar en navegadores Webkit (Chrome, Safari) */
        .scrollbar-thin::-webkit-scrollbar {
            height: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            border-radius: 10px;
        }
        /* Clases de colores para el scrollbar (se aplicarán con JS) */
        .scrollbar-thumb-blue-400::-webkit-scrollbar-thumb { background-color: #60a5fa; }
        .scrollbar-thumb-green-400::-webkit-scrollbar-thumb { background-color: #4ade80; }
        .scrollbar-thumb-red-400::-webkit-scrollbar-thumb { background-color: #f87171; }
        .scrollbar-thumb-yellow-400::-webkit-scrollbar-thumb { background-color: #facc15; }
        .scrollbar-thumb-orange-400::-webkit-scrollbar-thumb { background-color: #fb923c; }
        .scrollbar-thumb-stone-400::-webkit-scrollbar-thumb { background-color: #a8a29e; }
        .scrollbar-thumb-violet-400::-webkit-scrollbar-thumb { background-color: #a78bfa; }
        .scrollbar-thumb-gray-400::-webkit-scrollbar-thumb { background-color: #9ca3af; }
        .scrollbar-thumb-cyan-400::-webkit-scrollbar-thumb { background-color: #22d3ee; }
        .scrollbar-thumb-purple-400::-webkit-scrollbar-thumb { background-color: #c084fc; }
        .scrollbar-thumb-pink-400::-webkit-scrollbar-thumb { background-color: #f472b6; }

        /* Animación de entrada */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
    <script>
        // La configuración de Tailwind para el modo oscuro se maneja directamente
        // aplicando la clase 'dark' al <html>, que es el método estándar.
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300">

    <header class="sticky top-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-lg border-b border-gray-200 dark:border-gray-700 z-20">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white">Disnea y EKG</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400">Autor: Dr. Javier A. Rodríguez. MD, MSc - Septiembre 03 de 2025</p>
            </div>
            <button id="darkModeToggle" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-900" aria-label="Toggle dark mode">
                <!-- El icono se insertará con JS -->
            </button>
        </div>
    </header>
    
    <nav id="nav-bar" class="sticky top-[77px] md:top-[85px] bg-white/50 dark:bg-gray-800/50 backdrop-blur-lg z-10 border-b dark:border-gray-700">
         <div id="nav-scroll-container" class="container mx-auto px-4 py-2 flex items-center overflow-x-auto scrollbar-thin scrollbar-track-transparent">
            <div id="nav-buttons" class="flex space-x-2 p-1">
                <!-- Los botones de navegación se insertarán con JS -->
            </div>
        </div>
    </nav>

    <main id="main-content" class="container mx-auto p-4 md:p-6 lg:p-8">
        <!-- El contenido de la tarjeta se insertará con JS -->
    </main>
    
     <footer class="text-center py-4 text-xs text-gray-500 dark:text-gray-400">
         Forjado en el caos para fines educativos. No sustituye el juicio clínico.
     </footer>

    <script>
    // =================================================================================
    //  TODA LA LÓGICA Y DATOS DE LA APLICACIÓN
    // =================================================================================
    
    // --- ICONOS (Funciones que devuelven SVG como texto) ---
    const SunIcon = (className = 'w-6 h-6') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
    const MoonIcon = (className = 'w-6 h-6') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;
    const CheckCircleIcon = (className = 'w-5 h-5') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`;
    const XCircleIcon = (className = 'w-5 h-5') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>`;
    const SpeakerWaveIcon = (className = 'w-6 h-6') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`;
    const SpeakerOffIcon = (className = 'w-6 h-6') => `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>`;
    
    // --- CONFIGURACIÓN DE COLORES (definida antes para estar disponible globalmente) ---
    const colorVariants = { 
        blue: { bg: 'bg-blue-100 dark:bg-blue-900/50', text: 'text-blue-800 dark:text-blue-300', border: 'border-blue-500', ring: 'ring-blue-500', scrollbar: 'scrollbar-thumb-blue-400' }, 
        green: { bg: 'bg-green-100 dark:bg-green-900/50', text: 'text-green-800 dark:text-green-300', border: 'border-green-500', ring: 'ring-green-500', scrollbar: 'scrollbar-thumb-green-400' }, 
        red: { bg: 'bg-red-100 dark:bg-red-900/50', text: 'text-red-800 dark:text-red-300', border: 'border-red-500', ring: 'ring-red-500', scrollbar: 'scrollbar-thumb-red-400' }, 
        yellow: { bg: 'bg-yellow-100 dark:bg-yellow-900/50', text: 'text-yellow-800 dark:text-yellow-300', border: 'border-yellow-500', ring: 'ring-yellow-500', scrollbar: 'scrollbar-thumb-yellow-400' }, 
        orange: { bg: 'bg-orange-100 dark:bg-orange-900/50', text: 'text-orange-800 dark:text-orange-300', border: 'border-orange-500', ring: 'ring-orange-500', scrollbar: 'scrollbar-thumb-orange-400' }, 
        stone: { bg: 'bg-stone-100 dark:bg-stone-900/50', text: 'text-stone-700 dark:text-stone-300', border: 'border-stone-500', ring: 'ring-stone-500', scrollbar: 'scrollbar-thumb-stone-400' }, 
        violet: { bg: 'bg-violet-100 dark:bg-violet-900/50', text: 'text-violet-800 dark:text-violet-300', border: 'border-violet-500', ring: 'ring-violet-500', scrollbar: 'scrollbar-thumb-violet-400' }, 
        gray: { bg: 'bg-gray-100 dark:bg-gray-900/50', text: 'text-gray-700 dark:text-gray-300', border: 'border-gray-500', ring: 'ring-gray-500', scrollbar: 'scrollbar-thumb-gray-400' }, 
        cyan: { bg: 'bg-cyan-100 dark:bg-cyan-900/50', text: 'text-cyan-800 dark:text-cyan-300', border: 'border-cyan-500', ring: 'ring-cyan-500', scrollbar: 'scrollbar-thumb-cyan-400' }, 
        purple: { bg: 'bg-purple-100 dark:bg-purple-900/50', text: 'text-purple-800 dark:text-purple-300', border: 'border-purple-500', ring: 'ring-purple-500', scrollbar: 'scrollbar-thumb-purple-400' }, 
        pink: { bg: 'bg-pink-100 dark:bg-pink-900/50', text: 'text-pink-800 dark:text-pink-300', border: 'border-pink-500', ring: 'ring-pink-500', scrollbar: 'scrollbar-thumb-pink-400' }, 
    };

    // --- Componentes SVG de ECG ---
    const EcgGrid = () => `<defs><pattern id="smallGrid" width="5" height="5" patternUnits="userSpaceOnUse"><path d="M 5 0 L 0 0 0 5" fill="none" stroke="currentColor" stroke-opacity="0.1" stroke-width="0.5"/></pattern><pattern id="grid" width="25" height="25" patternUnits="userSpaceOnUse"><rect width="25" height="25" fill="url(#smallGrid)"/><path d="M 25 0 L 0 0 0 25" fill="none" stroke="currentColor" stroke-opacity="0.2" stroke-width="1"/></pattern></defs>`;
    const EcgNormalAuricular = () => `<div class="grid grid-cols-2 gap-2 text-sm font-semibold"><div class="text-gray-600 dark:text-gray-400"><h4 class="text-center font-bold mb-2">Onda P en DII</h4><svg viewBox="0 0 100 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C9 42, 11 42, 15 50 H20 L25 52 L30 20 L35 55 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div><div class="text-gray-600 dark:text-gray-400"><h4 class="text-center font-bold mb-2">Onda P en V1</h4><svg viewBox="0 0 100 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C8 46, 12 46, 15 50 C 18 54, 22 54, 25 50 H30 L35 45 L40 80 L45 50 H55 C59 38, 61 38, 65 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div></div>`;
    const EcgNormalHypertrophyComparison = () => `<div class="grid grid-cols-2 gap-2 text-sm font-semibold"><div class="text-gray-600 dark:text-gray-400"><h4 class="text-center font-bold mb-2">Complejo rS en V1</h4><svg viewBox="0 0 100 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C8 46, 12 46, 15 50 H20 L25 45 L30 80 L35 50 H45 C49 38, 51 38, 55 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div><div class="text-gray-600 dark:text-gray-400"><h4 class="text-center font-bold mb-2">Complejo QRS en V5/V6</h4><svg viewBox="0 0 100 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C9 42, 11 42, 15 50 H20 L25 52 L30 20 L35 55 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div></div>`;
    const EcgNormalLateralLeads = () => `<div class="text-gray-600 dark:text-gray-400 w-full md:w-2/3 mx-auto"><h4 class="text-center font-bold mb-2 text-xs md:text-sm">Complejo QRS y segmento ST/onda T normales en DI, aVL, V5 y V6</h4><svg viewBox="0 0 100 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C9 42, 11 42, 15 50 H20 L25 52 L30 20 L35 55 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div>`;
    const EcgCadDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.blue.text}">DII (P pulmonale)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C9 35, 11 35, 15 50 H25 L30 55 L35 20 L40 70 L45 50 H55 C59 38, 61 38, 65 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.blue.text}">V1 (Comp. + dominante)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C10 35, 15 35, 20 50 C 22 54, 24 54, 26 50 H35 L40 45 L45 80 L50 50 H60 C64 38, 66 38, 70 50 H85" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgCaiDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.green.text}">DII (P mitrale)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C9 42, 11 42, 15 50 C 19 42, 21 42, 25 50 H35 L40 55 L45 20 L50 70 L55 50 H65 C69 38, 71 38, 75 50 H90" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.green.text}">V1 (Comp. - dominante)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 C8 46, 12 46, 15 50 C 20 65, 28 65, 33 50 H40 L45 45 L50 80 L55 50 H65 C69 38, 71 38, 75 50 H90" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgHvi = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.red.text}">V1 (S profunda)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 45 L30 95 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.red.text}">V6 (R alta)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 55 L30 10 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgHvd = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.yellow.text}">V1 (R dominante)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 25 L30 65 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.yellow.text}">V6 (S profunda)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 45 L30 80 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgSsvi = () => `<svg viewBox="0 0 200 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M0 50 H5 C9 42, 11 42, 15 50 H25 L30 85 L35 5 L40 55 C 45 65, 52 65, 55 55 L60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/><text x="40" y="70" class="text-xs font-bold text-cyan-500" fill="currentColor">Infra ST + T invertida</text></svg>`;
    const EcgSdvi = () => `<svg viewBox="0 0 200 100" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M0 50 H5 C9 42, 11 42, 15 50 H25 L30 85 L35 5 L40 70 L45 50 H55 C59 38, 61 38, 65 50 H80" fill="none" stroke="currentColor" stroke-width="2"/><text x="35" y="15" class="text-xs font-bold text-purple-500" fill="currentColor">R alta</text><text x="65" y="35" class="text-xs font-bold text-purple-500" fill="currentColor">T positiva</text></svg>`;
    const EcgSgarbossaCriteria = () => `<svg viewBox="0 0 200 120" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M0 60 H 200" stroke="currentColor" stroke-opacity="0.2" stroke-width="1" stroke-dasharray="3 3"/><path d="M5 60 C8 55, 10 55, 12 60 H 18 L25 30 L35 60 C 38 55, 45 55, 50 65 L60 60" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M35 60 L 38 55" stroke="red" stroke-width="2.5"/><text x="30" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="30" dy="0">STE</tspan><tspan x="30" dy="10">Concordante</tspan></text><path d="M75 60 C78 55, 80 55, 82 60 H 88 L95 90 L105 60 C 108 65, 115 65, 120 55 L130 60" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M105 60 L 108 65" stroke="red" stroke-width="2.5"/><text x="100" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="100" dy="0">STD</tspan><tspan x="100" dy="10">Concordante</tspan></text><text x="100" y="105" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor">V1-V3</text><path d="M145 60 C148 55, 150 55, 152 60 H 158 L165 110 L175 60 C 178 30, 185 30, 190 40 L195 60" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M175 60 L 178 30" stroke="red" stroke-width="2.5"/><text x="170" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="170" dy="0">STE Discordante</tspan><tspan x="170" dy="10">Excesiva</tspan></text></svg>`;
    const EcgSmithCriteria = () => `<svg viewBox="0 0 100 125" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M0 60 H 100" stroke="currentColor" stroke-opacity="0.2" stroke-width="1" stroke-dasharray="3 3"/><path d="M5 60 C8 55, 10 55, 12 60 H18 L25 110 L35 60 C 38 40, 45 40, 50 50 L60 60" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M35 60 L 38 40" stroke="red" stroke-width="2.5"/><circle cx="35" cy="60" r="1.5" fill="blue" /><text x="37" y="65" class="text-[8px] font-bold" fill="blue">Punto J</text><path d="M25 110 L25 60" stroke="blue" stroke-width="1" stroke-dasharray="2 2" /><path d="M38 40 L38 60" stroke="red" stroke-width="1" stroke-dasharray="2 2" /><text x="5" y="20" class="text-[9px] font-bold" fill="currentColor">Relación ST/S ≤ -0.25</text><text x="40" y="45" class="text-[8px]" fill="red">STE</text><text x="10" y="85" class="text-[8px]" fill="blue">S</text></svg>`;
    const EcgBarcelonaCriteria = () => `<svg viewBox="0 0 300 140" class="w-full h-auto">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M0 70 H 300" stroke="currentColor" stroke-opacity="0.2" stroke-width="1" stroke-dasharray="3 3"/><path d="M5 70 C8 65, 10 65, 12 70 H 18 L25 40 L35 70 H 40 L 45 65 H 50 C 55 65, 60 75, 65 70 H 75" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M35 70 L 45 65" stroke="red" stroke-width="2.5"/><text x="40" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="40" dy="0">Elevación Concordante</tspan><tspan x="40" dy="10">del segmento ST</tspan></text><path d="M105 70 C108 65, 110 65, 112 70 H 118 L125 100 L135 70 H 140 L 145 75 H 150 C 155 75, 160 65, 165 70 H 175" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M135 70 L 145 75" stroke="red" stroke-width="2.5"/><text x="140" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="140" dy="0">Descenso Concordante</tspan><tspan x="140" dy="10">del segmento ST</tspan></text><path d="M205 70 C208 65, 210 65, 212 70 H 218 L225 85 L235 70 H 240 L 245 60 H 250 C 255 60, 260 65, 265 70 H 275" stroke="currentColor" stroke-width="2.5" fill="none"/><path d="M235 70 L 245 60" stroke="red" stroke-width="2.5"/><path d="M225 85 L225 70" stroke-dasharray="2 2" stroke="blue" stroke-width="0.8"/><text x="240" y="15" text-anchor="middle" class="text-[8px] font-bold" fill="currentColor"><tspan x="240" dy="0">Desviación Discordante</tspan><tspan x="240" dy="10">del segmento ST con</tspan><tspan x="240" dy="10">voltaje del QRS ≤ 6 mm</tspan></text></svg>`;
    const HeartConductionDiagram = ({ blocked, leads }) => { const isBlocked = (path) => path === blocked; return `<div class="px-4"><svg viewBox="0 0 100 120" class="w-full h-auto"><path d="M50 5 C 20 5, 10 30, 10 50 C 10 80, 50 105, 50 105 C 50 105, 90 80, 90 50 C 90 30, 80 5, 50 5 Z" fill="currentColor" class="text-red-500/10 dark:text-red-900/20" stroke="currentColor" stroke-width="0.5" /><text x="30" y="30" text-anchor="middle" class="text-[6px] font-sans font-bold">AD</text><text x="70" y="30" text-anchor="middle" class="text-[6px] font-sans font-bold">AI</text><text x="30" y="80" text-anchor="middle" class="text-[6px] font-sans font-bold">VD</text><text x="70" y="80" text-anchor="middle" class="text-[6px] font-sans font-bold">VI</text><path d="M35 20 C 45 30, 45 35, 50 40" stroke="orange" stroke-width="1.5" fill="none" /><path d="M50 40 L50 50" stroke="orange" stroke-width="1.5" fill="none" /><path d="M50 50 C 45 60, 40 70, 35 85" stroke="${isBlocked('rb') ? 'red' : 'orange'}" stroke-dasharray="${isBlocked('rb') ? '3 2' : 'none'}" stroke-width="1.5" fill="none" /><path d="M50 50 L55 60" stroke="${isBlocked('lb') || isBlocked('laf') || isBlocked('lpf') ? 'red' : 'orange'}" stroke-dasharray="${isBlocked('lb') ? '3 2' : 'none'}" stroke-width="1.5" fill="none" /><path d="M55 60 C 60 70, 65 80, 70 90" stroke="${isBlocked('laf') ? 'red' : 'orange'}" stroke-dasharray="${isBlocked('laf') ? '3 2' : 'none'}" stroke-width="1.5" fill="none" /><path d="M55 60 C 50 70, 50 80, 50 90" stroke="${isBlocked('lpf') ? 'red' : 'orange'}" stroke-dasharray="${isBlocked('lpf') ? '3 2' : 'none'}" stroke-width="1.5" fill="none" /><circle cx="35" cy="20" r="4" fill="orange" /><text x="25" y="18" class="text-[6px] font-sans" text-anchor="middle">N.SA</text><circle cx="50" cy="40" r="4" fill="orange" /><text x="50" y="35" class="text-[6px] font-sans" text-anchor="middle">N.AV</text>${isBlocked('rb') ? '<text x="32" y="75" fill="red" class="font-bold text-lg">X</text>' : ''}${isBlocked('lb') ? '<text x="58" y="55" fill="red" class="font-bold text-lg">X</text>' : ''}${isBlocked('laf') ? '<text x="68" y="78" fill="red" class="font-bold text-lg">X</text>' : ''}${isBlocked('lpf') ? '<text x="47" y="80" fill="red" class="font-bold text-lg">X</text>' : ''}${leads === 'branch' ? `<text x="25" y="60" text-anchor="middle" class="text-[8px] font-sans font-bold fill-current text-gray-500">V1</text><text x="80" y="70" text-anchor="middle" class="text-[8px] font-sans font-bold fill-current text-gray-500">V6</text>` : ''}${leads === 'fascicular' ? `<text x="95" y="40" text-anchor="end" class="text-[8px] font-sans font-bold fill-current text-gray-500">DI, aVL</text><text x="50" y="115" text-anchor="middle" class="text-[8px] font-sans font-bold fill-current text-gray-500">DII, DIII, aVF</text>` : ''}</svg></div>`; };
    const EcgBrdDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.orange.text}">V1 (rSR')<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H10 L15 45 L20 65 L25 25 L35 50 H45 C49 38, 51 38, 55 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.orange.text}">V6 (qRs ancha)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H10 L15 52 L20 20 L25 50 L35 70 L50 50 H60 C64 38, 66 38, 70 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgBriDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.stone.text}">V1 (rS ancha)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H10 L15 48 L25 75 L45 50 H55 C59 38, 61 38, 65 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div><div class="${colorVariants.stone.text}">V6 (R ancha/mellada)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 25 L25 30 L30 15 L50 50 L55 55 C60 65, 65 65, 70 50 H80" fill="none" stroke="currentColor" stroke-width="2.5"/></svg></div></div>`;
    const EcgBfaDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.violet.text}">DI, aVL (qR)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 55 L25 50 L30 20 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div><div class="${colorVariants.violet.text}">DII, DIII, aVF (rS)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 45 L30 70 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div></div>`;
    const EcgBfpDisplay = () => `<div class="grid grid-cols-2 gap-2 text-center text-sm font-semibold"><div class="${colorVariants.gray.text}">DI, aVL (rS)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 45 L30 70 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div><div class="${colorVariants.gray.text}">DII, DIII, aVF (qR)<svg viewBox="0 0 100 100">${EcgGrid()}<rect width="100%" height="100%" fill="url(#grid)" /><path d="M5 50 H15 L20 55 L25 50 L30 20 L40 50 H50 C54 38, 56 38, 60 50 H80" fill="none" stroke="currentColor" stroke-width="2"/></svg></div></div>`;
    
    // --- DATOS DE LA APLICACIÓN ---
    const ecgData = [ 
        { 
            id: 0, 
            title: 'Crecimiento Auricular Derecho (CAD)', 
            color: 'blue', 
            definition: 'Agrandamiento de la aurícula derecha, a menudo por sobrecarga de presión.', 
            clinicalContext: 'Frecuente en pacientes con EPOC, hipertensión pulmonar o estenosis tricuspídea.', 
            ecgComponent: EcgCadDisplay(), 
            criteria: ['Onda P ≥ 2.5 mm de altura en DII, DIII y aVF ("P pulmonale").','Onda P en V1 con componente inicial positivo y prominente.'], 
            performance: { 
                title: 'Rendimiento de Criterios de Onda P',
                text: `<table class="w-full text-left text-xs"><thead><tr class="border-b dark:border-gray-600"><th class="py-1 font-semibold">Criterio de Onda P</th><th class="py-1 text-center font-semibold">Sens.</th><th class="py-1 text-center font-semibold">Esp.</th><th class="py-1 text-center font-semibold">LR+</th><th class="py-1 text-center font-semibold">LR-</th></tr></thead><tbody><tr class="border-b dark:border-gray-700"><td class="py-1">P > 2.5 mm en DII</td><td class="py-1 text-center">6%</td><td class="py-1 text-center">100%</td><td class="py-1 text-center">∞</td><td class="py-1 text-center">0.94</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">Parte + de P en V1 > 1.5 mm</td><td class="py-1 text-center">17%</td><td class="py-1 text-center">100%</td><td class="py-1 text-center">∞</td><td class="py-1 text-center">0.83</td></tr></tbody></table><p class="mt-2 text-xs"><strong>Interpretación:</strong> Los criterios de la onda P para CAD son muy específicos (SpIn). Un hallazgo positivo <strong>confirma</strong> la enfermedad, pero un resultado negativo no la descarta debido a su baja sensibilidad.</p>`,
                ref: 'Referencia: Clinical Electrocardiography A Textbook. 5th Ed, 2021.'
            }, 
            audioText: "En el crecimiento auricular derecho, el vector de despolarización de la aurícula derecha aumenta en magnitud. Este vector se dirige hacia abajo y a la izquierda, por lo que se ve una onda P alta y picuda en de dos. En V1, que ve el corazón de frente, este mismo vector que se acerca genera un componente inicial de la P alto y positivo.", 
            quiz: { question: '¿Cuál es el hallazgo más característico del CAD?', options: ['Onda P ancha y mellada', 'Onda P alta y picuda', 'QRS ancho', 'Eje desviado a la izquierda'], correct: 1 } 
        }, 
        { 
            id: 1, 
            title: 'Crecimiento Auricular Izquierdo (CAI)', 
            color: 'green', 
            definition: 'Agrandamiento de la aurícula izquierda, usualmente por sobrecarga de volumen o presión.', 
            clinicalContext: 'Clásico en pacientes con estenosis o insuficiencia mitral, o hipertensión arterial sistémica de larga data.', 
            ecgComponent: EcgCaiDisplay(), 
            criteria: ['Onda P ≥ 120 ms de duración en DII, a menudo mellada ("P mitrale").','Onda P en V1 con componente terminal negativo ≥ 1 mm de profundidad y ≥ 40 ms de duración.'], 
            performance: { 
                title: 'Rendimiento de Criterios de Onda P',
                text: `<table class="w-full text-left text-xs"><thead><tr class="border-b dark:border-gray-600"><th class="py-1 font-semibold">Criterio de Onda P</th><th class="py-1 text-center font-semibold">Sens.</th><th class="py-1 text-center font-semibold">Esp.</th><th class="py-1 text-center font-semibold">LR+</th><th class="py-1 text-center font-semibold">LR-</th></tr></thead><tbody><tr class="border-b dark:border-gray-700"><td class="py-1">Índice de Morris en V1</td><td class="py-1 text-center">69%</td><td class="py-1 text-center">93%</td><td class="py-1 text-center">9.9</td><td class="py-1 text-center">0.33</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">P ≥120ms en DII + P term. neg >40ms en V1</td><td class="py-1 text-center">15%</td><td class="py-1 text-center">98%</td><td class="py-1 text-center">7.5</td><td class="py-1 text-center">0.87</td></tr></tbody></table><p class="mt-2 text-xs"><strong>Interpretación:</strong> El <strong>Índice de Morris</strong> (fuerza terminal de la onda P en V1 > 0.04 mm*s) es el criterio más sensible. Ambos criterios tienen un buen LR+ (>5), lo que <strong>aumenta moderadamente</strong> la probabilidad de CAI si están presentes.</p>`,
                ref: 'Referencia: Clinical Electrocardiography A Textbook. 5th Ed, 2021.'
            }, 
            audioText: "En el crecimiento auricular izquierdo, la despolarización de la aurícula izquierda, que es más tardía, se prolonga. Esto genera una onda P ancha y con una muesca en de dos. En V1, el vector de la aurícula derecha se acerca (positivo) y luego el vector de la aurícula izquierda agrandada se aleja (negativo), creando un componente final negativo, ancho y profundo, que es muy específico.", 
            quiz: { question: 'El término "P mitrale" se asocia con:', options: ['HVD', 'BRD', 'CAI', 'CAD'], correct: 2 } 
        },
        { id: 2, title: 'Hipertrofia Ventricular Izquierda (HVI)', color: 'red', definition: 'Aumento de la masa muscular del ventrículo izquierdo, comúnmente por hipertensión.', clinicalContext: 'Hallazgo típico en hipertensión arterial crónica, estenosis aórtica o miocardiopatía hipertrófica.', ecgComponent: EcgHvi(), criteria: ['**Sokolow-Lyon**: S en V1 + R en V5 o V6 ≥ 35 mm.','**Cornell**: R en aVL + S en V3 ≥ 28 mm (hombres), ≥ 20 mm (mujeres).','**R en aVL**: ≥ 11 mm.', '**Peguero-Lo Presti**: S más profunda (V1-V4) + S en V4 ≥ 28 mm (hombres), ≥ 23 mm (mujeres).'], performance: { title: 'Rendimiento Diagnóstico de Criterios de Voltaje', text: `<p class="mb-2">Ningún criterio es perfecto. El criterio de <strong>Peguero-Lo Presti</strong> ofrece el mejor balance, mientras que <strong>Sokolow-Lyon</strong> es muy específico.</p><table class="w-full text-left text-xs"><thead><tr class="border-b dark:border-gray-600"><th class="py-1 font-semibold">Criterio</th><th class="py-1 text-center font-semibold">Sens.</th><th class="py-1 text-center font-semibold">Esp.</th><th class="py-1 text-center font-semibold">LR+</th><th class="py-1 text-center font-semibold">LR-</th></tr></thead><tbody><tr class="border-b dark:border-gray-700"><td class="py-1">Peguero-Lo Presti</td><td class="py-1 text-center">57%</td><td class="py-1 text-center">90%</td><td class="py-1 text-center">5.7</td><td class="py-1 text-center">0.48</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">Cornell</td><td class="py-1 text-center">31%</td><td class="py-1 text-center">93%</td><td class="py-1 text-center">4.4</td><td class="py-1 text-center">0.74</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">Sokolow-Lyon</td><td class="py-1 text-center">14%</td><td class="py-1 text-center">99%</td><td class="py-1 text-center">14.0</td><td class="py-1 text-center">0.87</td></tr><tr><td class="py-1">R en aVL</td><td class="py-1 text-center">14%</td><td class="py-1 text-center">92%</td><td class="py-1 text-center">1.8</td><td class="py-1 text-center">0.93</td></tr></tbody></table><p class="mt-2 text-xs"><strong>Interpretación:</strong> Un <strong>LR+ > 5</strong> aumenta moderadamente la probabilidad de HVI. Un <strong>LR- cercano a 1</strong> no ayuda a descartarla.</p>`, ref: 'Referencia: Peguero JG, et al. J Am Coll Cardiol. 2017.' }, audioText: "En la hipertrofia ventricular izquierda, la mayor masa muscular del ventrículo izquierdo genera vectores eléctricos de mayor magnitud. El vector que se aleja de V1 produce una onda S muy profunda. El vector que se acerca a V5 y V6 produce una onda R muy alta. La suma de estos voltajes refleja el aumento de la masa ventricular.", quiz: { question: 'El criterio de Sokolow-Lyon para HVI suma el voltaje de:', options: ['R en V1 y S en V5', 'S en V1 y R en V5/V6', 'R en aVL y S en V3', 'DI y R en aVF'], correct: 1 } }, 
        { id: 3, title: 'Hipertrofia Ventricular Derecha (HVD)', color: 'yellow', definition: 'Aumento de la masa muscular del ventrículo derecho, a menudo por patología pulmonar.', clinicalContext: 'Suele asociarse a enfermedad pulmonar crónica (Cor pulmonale) y cardiopatías congénitas', ecgComponent: EcgHvd(), criteria: ['R dominante en V1 (R > S).','Eje eléctrico desviado a la derecha (> +110°).','S profunda en V5 o V6.','Descartar Bloqueo de Rama Derecha.'], performance: { title: 'Rendimiento Diagnóstico (R/S > 1 en V1)', text: 'Este es un criterio clásico con <strong>Sensibilidad muy baja (6%)</strong> pero <strong>Especificidad alta (98%)</strong>. Esto resulta en:<br/>- <strong>LR+ de 3.0:</strong> Aumenta levemente la probabilidad de HVD si está presente.<br/>- <strong>LR- de 0.96:</strong> Totalmente inútil para descartar HVD si está ausente.<br/>Como otros signos de HVD, su utilidad radica en la alta especificidad.', ref: 'Referencia: Clinical Electrocardiography A Textbook. 5th Ed, 2021.' }, audioText: "Normalmente, el ventrículo izquierdo domina el electrocardiograma. En la hipertrofia ventricular derecha, el aumento de masa del ventrículo derecho invierte esto. El vector de despolarización se dirige hacia la derecha y adelante, hacia V1, generando una onda R alta y dominante donde debería haber una S. Por el contrario, este vector se aleja de V5 y V6, dejando una S profunda.", quiz: { question: '¿Qué hallazgo en V1 es sugestivo de HVD?', options: ['Onda S profunda', 'rS', 'Onda R alta y dominante', 'rSR\''], correct: 2 } }, 
        { id: 4, title: 'Bloqueo de Rama Derecha (BRD)', color: 'orange', definition: 'Retraso en la conducción por la rama derecha, despolarizando el VD de forma tardía.', clinicalContext: 'Puede ser un hallazgo normal en jóvenes, pero también se ve en cardiopatía isquémica o chagásica o sobrecargas derechas como en el TEP.', ecgComponent: EcgBrdDisplay(), conductionBlock: 'rb', leadType: 'branch', criteria: ['QRS ≥ 120 ms.','Eje es normal o a la derecha.','Morfología rSR\', rsR\', o en M en V1-V2.','S ancha y empastada en DI y V6.'], audioText: "En el bloqueo de rama derecha, el ventrículo izquierdo se despolariza normalmente, lo que genera la onda r y la onda S en V1. Luego, el estímulo viaja lentamente al ventrículo derecho. Este vector tardío se dirige hacia V1, creando la segunda onda R, o R prima. Este mismo vector se aleja de V6, generando la onda S ancha y final. El QRS se ensancha porque el proceso es lento.", quiz: { question: 'La morfología rSR\' en V1 es clásica de:', options: ['BRI', 'HVI', 'BRD', 'CAI'], correct: 2 } }, 
        { id: 5, title: 'Bloqueo de Rama Izquierda (BRI)', color: 'stone', definition: 'Retraso en la conducción por la rama izquierda, alterando la despolarización ventricular.', clinicalContext: 'Casi siempre patológico, asociado a cardiopatía isquémica, miocardiopatías, HVI avanzada o valvulopatías.', ecgComponent: EcgBriDisplay(), conductionBlock: 'lb', leadType: 'branch', criteria: ['QRS ≥ 120 ms.','Eje normal o a la izquierda.','R ancha, mellada o empastada en DI, aVL, V5, V6.','Ausencia de onda Q septal en DI, V5-V6.','Morfología QS o rS en V1.'], audioText: "En el bloqueo de rama izquierda, la despolarización inicial del septo, que va de izquierda a derecha, se pierde. Todo el estímulo viaja desde el ventrículo derecho hacia el ventrículo izquierdo, lentamente. Este gran vector que se aleja de V1 produce un complejo ancho y negativo (QS o rS). Este mismo vector que se acerca a V6 produce una onda R ancha y mellada, sin la q inicial.", quiz: { question: 'En un BRI, ¿qué se espera ver en V5-V6?', options: ['Ondas Q profundas', 'Complejos rS', 'Ondas R anchas y melladas', 'Ondas T picudas'], correct: 2 } }, 
        { id: 6, title: 'BRI y Dolor Torácico', color: 'pink', definition: 'Criterios para diagnosticar Infarto Agudo de Miocardio (IAM) en presencia de BRI.', clinicalContext: 'Un desafío diagnóstico, ya que el BRI basal puede enmascarar o simular los cambios isquémicos agudos.', ecgPatterns: [ { title: 'Criterios de Sgarbossa', component: EcgSgarbossaCriteria() }, { title: 'Criterio de Smith (Sgarbossa Modificado)', component: EcgSmithCriteria() }, { title: 'Algoritmo de Barcelona', component: EcgBarcelonaCriteria() } ], criteria: [ '**Criterios de Barcelona:**<br/>- Elevación concordante del segmento ST ≥1 mm.<br/>- Descenso concordante del segmento ST ≥1 mm.<br/>- Desviación discordante del segmento ST ≥1 mm con QRS de bajo voltaje (≤6 mm).', '**Criterios de Smith (Sgarbossa Modificado):**<br/>- Elevación del ST discordante con una relación ST/S ≤ -0.25 (la magnitud de la elevación del ST es ≥25% de la magnitud de la onda S).', '**Criterios de Sgarbossa (Score ≥ 3):**<br/>- Elevación ST ≥1 mm concordante (5 pts).<br/>- Depresión ST ≥1 mm en V1-V3 (3 pts).<br/>- Elevación ST ≥5 mm discordante (2 pts).' ], performance: { title: 'Rendimiento Diagnóstico Comparativo para IAM', text: `<p class="mb-2">El <strong>Algoritmo Barcelona</strong> demuestra la mayor sensibilidad manteniendo una alta especificidad, haciéndolo el más robusto clínicamente.</p><table class="w-full text-left text-xs"><thead><tr class="border-b dark:border-gray-600"><th class="py-1 font-semibold">Criterio</th><th class="py-1 text-center font-semibold">Sens.</th><th class="py-1 text-center font-semibold">Esp.</th><th class="py-1 text-center font-semibold">LR+</th><th class="py-1 text-center font-semibold">LR-</th></tr></thead><tbody><tr class="border-b dark:border-gray-700"><td class="py-1">Barcelona</td><td class="py-1 text-center">93%</td><td class="py-1 text-center">94%</td><td class="py-1 text-center">15.5</td><td class="py-1 text-center">0.07</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">Smith IV</td><td class="py-1 text-center">50%</td><td class="py-1 text-center">96%</td><td class="py-1 text-center">12.5</td><td class="py-1 text-center">0.52</td></tr><tr class="border-b dark:border-gray-700"><td class="py-1">Sgarbossa (≥3)</td><td class="py-1 text-center">33%</td><td class="py-1 text-center">99%</td><td class="py-1 text-center">33.0</td><td class="py-1 text-center">0.68</td></tr></tbody></table><p class="mt-2 text-xs"><strong>Interpretación:</strong> Un <strong>LR+ > 10</strong> aumenta fuertemente la probabilidad de IAM. Un <strong>LR- < 0.1</strong> prácticamente lo descarta.</p>`, ref: 'Refs: Di Marco A, et al. J Am Heart Assoc. 2020. | Smith SW, et al. Ann Emerg Med. 2012. | Sgarbossa EB, et al. N Engl J Med. 1996.' }, audioText: "En un bloqueo de rama izquierda normal, la repolarización, o sea el segmento ST, es discordante con el QRS. Los criterios para infarto buscan violaciones a esta regla. Una desviación del segmento ST concordante, en la misma dirección que el QRS, es altamente sospechosa de isquemia. Igualmente, una desviación discordante que es excesiva, como la medida por el criterio de Smith, también sugiere un infarto subyacente.", quiz: { question: '¿Qué criterio tiene la mejor sensibilidad para IAM con BRI?', options: ['Sgarbossa', 'Barcelona', 'Smith', 'Cornell'], correct: 1 } }, 
        { id: 7, title: 'Bloqueo Fascicular Anterior (BFA)', color: 'violet', definition: 'Bloqueo del fascículo anterior de la rama izquierda, desviando el eje a la izquierda.', clinicalContext: 'Común en pacientes con HVI, cardiopatía isquémica o enfermedad degenerativa del sistema de conducción.', ecgComponent: EcgBfaDisplay(), conductionBlock: 'laf', leadType: 'fascicular', criteria: ['Eje desviado a la izquierda (entre -45° y -90°).','QRS < 120 ms.','Morfología rS en DII, DIII y aVF.','Morfología qR en DI y aVL.'], audioText: "En el bloqueo fascicular anterior, la parte anterosuperior del ventrículo izquierdo se activa de forma tardía. El vector final de despolarización se dirige hacia arriba y a la izquierda. Este vector se acerca a de uno y aVL, y se aleja de de dos, de tres y aVF, lo cual desvía el eje eléctricamente hacia la izquierda extrema.", quiz: { question: '¿Cuál es el hallazgo más importante en un BFA?', options: ['QRS > 120 ms', 'Eje derecho', 'Eje izquierdo extremo', 'Ondas P altas'], correct: 2 } }, 
        { id: 8, title: 'Bloqueo Fascicular Posterior (BFP)', color: 'gray', definition: 'Bloqueo del fascículo posterior de la rama izquierda. Diagnóstico raro y de exclusión.', clinicalContext: 'Muy raro de forma aislada. Se debe sospechar cardiopatía isquémica extensa o enfermedad degenerativa.', ecgComponent: EcgBfpDisplay(), conductionBlock: 'lpf', leadType: 'fascicular', criteria: ['Eje desviado a la derecha (> +110°).','QRS < 120 ms.','Morfología rS en DI y aVL.','Morfología qR en DII, DIII y aVF.','Descartar otras causas de eje derecho.'], audioText: "El bloqueo fascicular posterior es el opuesto al anterior. La parte posteroinferior del ventrículo izquierdo se activa tardíamente. El vector final se dirige hacia abajo y a la derecha. Este vector se acerca a de dos, de tres y aVF, y se aleja de de uno y aVL, desviando el eje a la derecha. Es un diagnóstico de exclusión.", quiz: { question: 'El BFP es un diagnóstico de exclusión para:', options: ['Eje izquierdo', 'QRS ancho', 'Eje derecho', 'Onda U prominente'], correct: 2 } }, 
        { id: 9, title: 'Sobrecarga Sistólica del VI (SSVI)', color: 'cyan', definition: 'Patrón de "strain" ventricular, refleja HVI con alteración de la repolarización.', clinicalContext: 'Indica HVI severa y de larga data, como en la estenosis aórtica crítica o hipertensión no controlada.', ecgComponent: EcgSsvi(), criteria: ['Criterios de voltaje para HVI.','Infradesnivel del ST descendente en V5-V6, DI y aVL.','Onda T invertida y asimétrica en las mismas derivaciones.'], audioText: "El patrón de 'strain' indica que un ventrículo izquierdo muy hipertrofiado no se está repolarizando bien, a menudo por isquemia subendocárdica. El vector de repolarización, es decir, la onda T, se invierte y se aleja de las derivaciones izquierdas como V6, causando las ondas T negativas. El segmento ST se infradesnivela por la misma razón.", quiz: { question: 'El patrón de "strain" del VI se caracteriza por HVI más:', options: ['Ondas T altas', 'ST descendente y T invertida', 'Ondas U prominentes', 'PR corto'], correct: 1 } }, 
        { id: 10, title: 'Sobrecarga Diastólica del VI (SDVI)', color: 'purple', definition: 'Refleja HVI por sobrecarga de volumen, con voltajes altos pero sin "strain".', clinicalContext: 'Se observa en condiciones de sobrecarga de volumen como la insuficiencia aórtica o mitral severa.', ecgComponent: EcgSdvi(), criteria: ['Criterios de voltaje para HVI.','Ondas Q profundas en derivaciones laterales.','Ondas T positivas y picudas.'], audioText: "En la sobrecarga de volumen, el ventrículo está dilatado e hipertrofiado, pero la repolarización es normal o incluso aumentada. Los voltajes de R son altos, pero los vectores de la onda T no se alteran y permanecen positivos. Las ondas Q profundas en derivaciones izquierdas reflejan la mayor despolarización septal.", quiz: { question: 'A diferencia de la sobrecarga sistólica, en la diastólica la onda T suele ser:', options: ['Invertida', 'Plana', 'Positiva y picuda', 'Bifásica'], correct: 2 } }, 
    ];
    
    // --- LÓGICA DE LA APLICACIÓN ---
    document.addEventListener('DOMContentLoaded', () => {
        let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let activeTabId = 0;
        let showNormal = false;
        let isSpeaking = false;

        const navButtonsContainer = document.getElementById('nav-buttons');
        const mainContentContainer = document.getElementById('main-content');
        const darkModeToggleButton = document.getElementById('darkModeToggle');
        const navScrollContainer = document.getElementById('nav-scroll-container');

        // Función principal que renderiza todo
        function render() {
            // Actualizar modo oscuro
            document.documentElement.classList.toggle('dark', isDarkMode);
            darkModeToggleButton.innerHTML = isDarkMode ? SunIcon() : MoonIcon();

            // Renderizar botones de navegación
            const activeData = ecgData.find(d => d.id === activeTabId) || ecgData[0];
            const colors = colorVariants[activeData.color];

            navButtonsContainer.innerHTML = ecgData.map(item => {
                const itemColors = colorVariants[item.color];
                const isActive = item.id === activeTabId;
                const activeClasses = `${itemColors.bg.replace('/50','')} ${itemColors.text} ${itemColors.ring}`;
                const inactiveClasses = 'text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700';

                return `<button data-id="${item.id}"
                    class="nav-button flex-shrink-0 px-4 py-2 rounded-md text-sm font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 ${isActive ? activeClasses : inactiveClasses}">
                    ${item.title.split('(')[0].trim()}
                </button>`;
            }).join('');
            
            // Actualizar scrollbar color
            navScrollContainer.className = `container mx-auto px-4 py-2 flex items-center overflow-x-auto scrollbar-thin scrollbar-track-transparent ${colors.scrollbar}`;

            // Renderizar contenido principal
            mainContentContainer.innerHTML = renderContentCard(activeData, colors);
        }

        // Función para renderizar la tarjeta de contenido
        function renderContentCard(data, colors) {
            const isBlock = !!data.conductionBlock;

            const criteriaList = data.criteria.map(item => {
                const formattedItem = item.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-gray-900 dark:text-white">$1</strong>');
                return `<li class="flex items-start">
                    <span class="mr-3 mt-1.5 flex-shrink-0 h-2 w-2 rounded-full ${colors.bg.replace('100','500').replace('900/50', '400')}"></span>
                    <span>${formattedItem}</span>
                </li>`;
            }).join('');

            const performanceHTML = data.performance ? `
                <h3 class="font-semibold mb-4 text-lg mt-6">${data.performance.title}</h3>
                <div class="text-sm p-4 rounded-lg border ${colors.border}/30 ${colors.bg}">
                    <div class="mb-2">${data.performance.text}</div>
                    <p class="text-xs text-right opacity-70 italic">${data.performance.ref}</p>
                </div>` : '';

            const ecgPatternsHTML = data.ecgPatterns ? data.ecgPatterns.map(pattern => `
                <div class="p-4 rounded-lg ${colors.bg}">
                    <h4 class="text-center font-bold mb-2 ${colors.text}">${pattern.title}</h4>
                    <div class="${colors.text}">${pattern.component}</div>
                </div>`).join('<div class="h-6"></div>') :
                `<div class="p-4 rounded-lg ${colors.bg}">
                     <h4 class="text-center font-bold mb-2 ${colors.text}">Patrón Típico</h4>
                     <div class="${colors.text}">${data.ecgComponent}</div>
                 </div>`;

            const normalComparisonHTML = showNormal && data.ecgComponent ? `
                 <div class="mt-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400">
                    <h4 class="text-center font-bold mb-2">ECG Normal de Comparación</h4>
                    ${
                        (data.id === 0 || data.id === 1) ? EcgNormalAuricular() :
                        (data.id === 2 || data.id === 3) ? EcgNormalHypertrophyComparison() :
                        (data.id === 9 || data.id === 10) ? EcgNormalLateralLeads() :
                        EcgNormal()
                    }
                </div>` : '';
            
            const compareButtonHTML = data.ecgComponent ? `
                <div class="mt-4 flex justify-center">
                    <button id="compare-button" class="px-4 py-2 rounded-md text-sm font-medium transition-colors ${showNormal ? 'bg-gray-200 dark:bg-gray-700' : `${colors.bg} ${colors.text}`}">
                        ${showNormal ? 'Ocultar ECG Normal' : 'Comparar con Normal'}
                    </button>
                </div>` : '';

            const mainLayout = isBlock ? `
                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div>
                        <h3 class="font-semibold mb-2 text-lg text-center">Fisiopatología del Bloqueo</h3>
                        ${HeartConductionDiagram({ blocked: data.conductionBlock, leads: data.leadType })}
                        <h3 class="font-semibold mt-6 mb-4 text-lg text-center">Patrones ECG Clave</h3>
                        <div class="p-4 rounded-lg ${colors.bg}">${data.ecgComponent}</div>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-4 text-lg">Criterios Diagnósticos</h3>
                        <ul class="space-y-2 mb-8">${criteriaList}</ul>
                        <h3 class="font-semibold mb-4 text-lg">Prueba Rápida</h3>
                        ${renderQuiz(data.quiz, colors)}
                    </div>
                </div>` : `
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-semibold mb-4 text-lg">Patrones Electrocardiográficos</h3>
                        <div class="space-y-6">${ecgPatternsHTML}</div>
                        ${compareButtonHTML}
                        ${normalComparisonHTML}
                    </div>
                    <div>
                        <h3 class="font-semibold mb-4 text-lg">Criterios Diagnósticos</h3>
                        <ul class="space-y-2 mb-4">${criteriaList}</ul>
                        ${performanceHTML}
                        <h3 class="font-semibold mb-4 text-lg mt-6">Prueba Rápida</h3>
                        ${renderQuiz(data.quiz, colors)}
                    </div>
                </div>`;

            return `
            <div class="fade-in bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border-t-4 ${colors.border}">
                <div class="p-6 md:p-8">
                    <div class="flex items-center justify-between mb-2">
                        <h2 class="text-2xl md:text-3xl font-bold ${colors.text}">${data.title}</h2>
                        <button id="audio-button" class="p-2 rounded-full transition-colors ${colors.text} ${colors.bg} hover:opacity-80" title="Escuchar explicación">
                            ${isSpeaking ? SpeakerOffIcon() : SpeakerWaveIcon()}
                        </button>
                    </div>
                    <p class="text-gray-600 dark:text-gray-300 mb-4">${data.definition}</p>
                    <div class="p-3 mb-6 rounded-lg border text-sm ${colors.border}/30 ${colors.bg}">
                        <strong class="font-semibold">Contexto Clínico:</strong> ${data.clinicalContext}
                    </div>
                    ${mainLayout}
                </div>
            </div>`;
        }

        // Función para renderizar el quiz
        function renderQuiz(quizData, colors) {
            const optionsHTML = quizData.options.map((option, index) =>
                `<button data-index="${index}" class="quiz-option w-full text-left p-3 rounded-md border-2 transition-all duration-200 bg-white dark:bg-gray-700 border-transparent hover:border-gray-300 dark:hover:border-gray-500">
                    <span>${option}</span>
                </button>`
            ).join('');

            return `
            <div id="quiz-container" class="p-4 rounded-lg border ${colors.border}/30 ${colors.bg}">
                <p class="font-semibold mb-4">${quizData.question}</p>
                <div class="space-y-2 mb-4">${optionsHTML}</div>
                <div id="quiz-feedback" class="text-center"></div>
            </div>`;
        }
        
        // --- MANEJO DE EVENTOS ---
        
        // Toggle modo oscuro
        darkModeToggleButton.addEventListener('click', () => {
            isDarkMode = !isDarkMode;
            render();
        });

        // Navegación principal
        navButtonsContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.nav-button');
            if (button) {
                const newId = parseInt(button.dataset.id, 10);
                if (newId !== activeTabId) {
                    activeTabId = newId;
                    showNormal = false; // Resetear vista de comparación
                    if (speechSynthesis.speaking) speechSynthesis.cancel();
                    isSpeaking = false;
                    render();
                }
            }
        });

        // Eventos dentro del contenido principal (delegación)
        mainContentContainer.addEventListener('click', e => {
            // Botón de audio
            if (e.target.closest('#audio-button')) {
                const activeData = ecgData.find(d => d.id === activeTabId);
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    isSpeaking = false;
                } else {
                    const utterance = new SpeechSynthesisUtterance(activeData.audioText);
                    utterance.lang = 'es-ES';
                    utterance.onstart = () => { isSpeaking = true; render(); };
                    utterance.onend = () => { isSpeaking = false; render(); };
                    utterance.onerror = () => { isSpeaking = false; render(); };
                    speechSynthesis.speak(utterance);
                }
                render(); // Re-render para cambiar el icono
            }
            // Botón de comparación
            if (e.target.closest('#compare-button')) {
                showNormal = !showNormal;
                render();
            }

            // Opciones del Quiz
            const quizOption = e.target.closest('.quiz-option');
            if (quizOption) {
                const activeData = ecgData.find(d => d.id === activeTabId);
                const quizData = activeData.quiz;
                const selectedIndex = parseInt(quizOption.dataset.index, 10);
                const isCorrect = selectedIndex === quizData.correct;
                
                const allOptions = document.querySelectorAll('.quiz-option');
                allOptions.forEach(opt => {
                    opt.disabled = true;
                    const optIndex = parseInt(opt.dataset.index, 10);
                    // Marcar la respuesta correcta
                    if (optIndex === quizData.correct) {
                        opt.classList.add('border-green-500', 'bg-green-200', 'dark:bg-green-800');
                    }
                    // Marcar la incorrecta si fue seleccionada
                    if (optIndex === selectedIndex && !isCorrect) {
                         opt.classList.add('border-red-500', 'bg-red-200', 'dark:bg-red-800');
                    }
                });

                const feedbackContainer = document.getElementById('quiz-feedback');
                const colors = colorVariants[activeData.color];
                feedbackContainer.innerHTML = `<button id="reset-quiz" class="text-sm font-semibold ${colors.text} hover:underline">Intentar de nuevo</button>`;
            }

            // Reset del Quiz
            if(e.target.closest('#reset-quiz')) {
                render(); // Simplemente re-renderiza la tarjeta
            }
        });

        // Renderizado inicial
        render();
    });
    </script>
</body>
</html>
